(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}})();const i={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"19f41143-ea74-441e-a01f-9fead8db8286","Content-Type":"application/json"}},u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),z=()=>fetch(`${i.baseUrl}/users/me`,{headers:i.headers}).then(u),M=()=>fetch(`${i.baseUrl}/cards`,{headers:i.headers}).then(u),K=({name:e,about:t})=>fetch(`${i.baseUrl}/users/me`,{method:"PATCH",headers:i.headers,body:JSON.stringify({name:e,about:t})}).then(u),R=e=>fetch(`${i.baseUrl}/users/me/avatar`,{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:e})}).then(u),G=({name:e,link:t})=>fetch(`${i.baseUrl}/cards`,{method:"POST",headers:i.headers,body:JSON.stringify({name:e,link:t})}).then(u),Q=e=>fetch(`${i.baseUrl}/cards/${e}`,{method:"DELETE",headers:i.headers}).then(u),X=(e,t)=>fetch(`${i.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:i.headers}).then(u),$=(e,t,o)=>{const r=e.classList.contains("card__like-button_is-active");X(t,r).then(n=>{e.classList.toggle("card__like-button_is-active"),o.textContent=n.likes.length}).catch(n=>{console.log(n)})},A=(e,t)=>{Q(t).then(()=>{e.remove()}).catch(o=>{console.log(o)})},Y=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),F=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:r},n)=>{const c=Y(),a=c.querySelector(".card__like-button"),s=c.querySelector(".card__control-button_type_delete"),m=c.querySelector(".card__image"),g=c.querySelector(".card__like-count");return m.src=e.link,m.alt=e.name,c.querySelector(".card__title").textContent=e.name,g&&(g.textContent=e.likes.length),e.likes.some(V=>V._id===n)&&a.classList.add("card__like-button_is-active"),e.owner._id!==n&&s.remove(),o&&a.addEventListener("click",()=>o(a,e._id,g)),r&&e.owner._id===n&&s.addEventListener("click",()=>r(c,e._id)),t&&m.addEventListener("click",()=>t({name:e.name,link:e.link})),c},N=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");p(t)}},y=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",N)},p=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",N)},Z=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{p(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&p(e)})};function ee(e,t,o){const r=e.querySelector(`#${t.id}-error`);t.classList.add(o.inputErrorClass),r.classList.add(o.errorClass),t.validity.patternMismatch&&t.dataset.errorMessage?r.textContent=t.dataset.errorMessage:r.textContent=t.validationMessage}function O(e,t,o){const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),r.classList.remove(o.errorClass),r.textContent=""}function te(e,t,o){t.validity.valid?O(e,t,o):ee(e,t,o)}function oe(e){return e.some(t=>!t.validity.valid)}function D(e,t){e.classList.add(t.inactiveButtonClass),e.disabled=!0}function ne(e,t){e.classList.remove(t.inactiveButtonClass),e.disabled=!1}function w(e,t,o){oe(e)?D(t,o):ne(t,o)}function re(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);w(o,r,t),o.forEach(n=>{n.addEventListener("input",()=>{te(e,n,t),w(o,r,t)})})}function q(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o.forEach(n=>{O(e,n,t)}),D(r,t)}function ce(e){Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{o.addEventListener("submit",r=>{r.preventDefault()}),re(o,e)})}const L={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};ce(L);let b;const W=document.querySelector(".places__list"),C=document.querySelector(".popup_type_edit"),h=C.querySelector(".popup__form"),j=h.querySelector(".popup__input_type_name"),H=h.querySelector(".popup__input_type_description"),k=document.querySelector(".popup_type_new-card"),l=k.querySelector(".popup__form"),se=l.querySelector(".popup__input_type_card-name"),ie=l.querySelector(".popup__input_type_url"),E=document.querySelector(".popup_type_image"),P=E.querySelector(".popup__image"),ae=E.querySelector(".popup__caption"),le=document.querySelector(".profile__edit-button"),ue=document.querySelector(".profile__add-button"),x=document.querySelector(".profile__title"),I=document.querySelector(".profile__description"),B=document.querySelector(".profile__image"),T=document.querySelector(".popup_type_edit-avatar"),_=T.querySelector(".popup__form"),pe=_.querySelector(".popup__input"),S=document.querySelector(".popup_type_info"),de=S.querySelector(".popup__title"),f=S.querySelector(".popup__info"),me=S.querySelector(".popup__text"),U=S.querySelector(".popup__list"),fe=document.querySelector(".logo"),J=({name:e,link:t})=>{P.src=t,P.alt=e,ae.textContent=e,y(E)},v=(e,t)=>{const r=document.getElementById("popup-info-definition-template").content.querySelector(".popup__info-item").cloneNode(!0);return r.querySelector(".popup__info-term").textContent=e,r.querySelector(".popup__info-description").textContent=t,r},_e=e=>{const o=document.getElementById("popup-info-user-preview-template").content.querySelector(".popup__list-item").cloneNode(!0);return o.textContent=e,o},ye=()=>{M().then(e=>{de.textContent="Статистика карточек",f.innerHTML="",U.innerHTML="";const t=new Set;let o=0,r=0,n="";const c={};e.forEach(s=>{t.add(s.owner._id),o+=s.likes.length,s.likes.length>r&&(r=s.likes.length,n=s.owner.name),(!c[s.name]||s.likes.length>c[s.name].count)&&(c[s.name]={count:s.likes.length,name:s.name})});const a=Object.values(c).sort((s,m)=>m.count-s.count).slice(0,3);f.append(v("Всего пользователей:",t.size)),f.append(v("Всего лайков:",o)),f.append(v("Максимально лайков от одного:",r)),f.append(v("Чемпион лайков:",n)),me.textContent="Популярные карточки:",a.forEach(s=>{U.append(_e(s.name))}),y(S)}).catch(e=>{console.log(e)})},d=(e,t,o="Сохранение...")=>{t?e.textContent=o:e.textContent=e.dataset.originalText},he=e=>{e.preventDefault();const t=h.querySelector(".popup__button");t.dataset.originalText||(t.dataset.originalText=t.textContent),d(t,!0),K({name:j.value,about:H.value}).then(o=>{x.textContent=o.name,I.textContent=o.about,p(C)}).catch(o=>{console.log(o)}).finally(()=>{d(t,!1)})},Se=e=>{e.preventDefault();const t=_.querySelector(".popup__button");t.dataset.originalText||(t.dataset.originalText=t.textContent),d(t,!0),R(pe.value).then(o=>{B.style.backgroundImage=`url(${o.avatar})`,p(T)}).catch(o=>{console.log(o)}).finally(()=>{d(t,!1)})},ve=e=>{e.preventDefault();const t=l.querySelector(".popup__button");t.dataset.originalText||(t.dataset.originalText=t.textContent),d(t,!0,"Создание..."),G({name:se.value,link:ie.value}).then(o=>{W.prepend(F(o,{onPreviewPicture:J,onLikeIcon:$,onDeleteCard:A},b)),l.reset(),p(k)}).catch(o=>{console.log(o)}).finally(()=>{d(t,!1)})};h.addEventListener("submit",he);l.addEventListener("submit",ve);_.addEventListener("submit",Se);le.addEventListener("click",()=>{j.value=x.textContent,H.value=I.textContent,q(h,L),y(C)});B.addEventListener("click",()=>{_.reset(),q(_,L),y(T)});ue.addEventListener("click",()=>{l.reset(),q(l,L),y(k)});fe.addEventListener("click",ye);const Le=document.querySelectorAll(".popup");Le.forEach(e=>{Z(e)});Promise.all([M(),z()]).then(([e,t])=>{b=t._id,x.textContent=t.name,I.textContent=t.about,B.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{W.append(F(o,{onPreviewPicture:J,onLikeIcon:$,onDeleteCard:A},b))})}).catch(e=>{console.log(e)});
